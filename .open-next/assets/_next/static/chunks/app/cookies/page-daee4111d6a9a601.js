(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{63:(e,t,r)=>{"use strict";var s=r(7260);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},571:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(5155),a=r(2115),l=r(63),i=r(8712);function o(){let{user:e,loading:t}=(0,i.A)(),r=(0,l.useRouter)(),[o,n]=(0,a.useState)([]),[c,d]=(0,a.useState)([]),[h,u]=(0,a.useState)(!1),[x,m]=(0,a.useState)(""),[p,g]=(0,a.useState)("list"),[b,f]=(0,a.useState)(null),[w,j]=(0,a.useState)(""),[v,N]=(0,a.useState)(""),[y,k]=(0,a.useState)(null),[C,S]=(0,a.useState)(!1),[E,F]=(0,a.useState)(!1),[D,T]=(0,a.useState)(new Set),[P,A]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t||e||r.push("/auth/login?redirect=/cookies")},[e,t,r]),(0,a.useEffect)(()=>{e&&O()},[e]);let O=async()=>{u(!0),m("");try{let[e,t]=await Promise.all([fetch("/api/cookies/list"),fetch("/api/config/crawlers")]);if(401===e.status||401===t.status)return void r.push("/auth/login?redirect=/cookies");if(!e.ok)throw Error("Failed to fetch cookies");let s=await e.json(),a=[];t.ok&&(a=await t.json()),s.sort((e,t)=>{let r=a.some(t=>{var r;return null==(r=t.cookieFile)?void 0:r.includes(e.filename)}),s=a.some(e=>{var r;return null==(r=e.cookieFile)?void 0:r.includes(t.filename)});return r&&!s?-1:!r&&s?1:e.name.localeCompare(t.name)}),n(s),d(a)}catch(e){m(e instanceof Error?e.message:"Failed to load data")}finally{u(!1)}},L=async()=>{if(confirm("Are you sure you want to restart the service? This may interrupt active tasks.")){F(!0);try{let e=await fetch("/api/server/restart",{method:"POST"});if(e.ok)alert("Service restart triggered successfully.");else{let t=await e.text();alert("Failed to restart service: ".concat(t))}}catch(e){console.error("Restart failed:",e),alert("Failed to trigger restart.")}finally{F(!1)}}},z=async e=>{u(!0);try{let t=await fetch("/api/cookies/view/".concat(e));if(!t.ok)throw Error("Failed to load cookie details");let r=await t.json();f(r),j(r.name),N(r.content),k(null),g("edit")}catch(e){m(e instanceof Error?e.message:"Failed to load cookie for editing")}finally{u(!1)}},R=async e=>{e.preventDefault(),S(!0),k(null);try{let e=await fetch("/api/cookies",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({finder:w,cookie:v})}),t=await e.text();e.ok?(k("Success: Cookie updated!"),O(),setTimeout(()=>{"create"===p&&g("list")},1500)):k("Error: ".concat(t," (").concat(e.status,")"))}catch(e){k("Error: ".concat(e.message))}finally{S(!1)}},_=e=>c.filter(t=>t.cookieFile&&t.cookieFile.includes(e.filename)),B=e=>{let t=new Set(D);t.has(e)?t.delete(e):t.add(e),T(t)},M=e=>{e?T(new Set(o.map(e=>e.filename))):T(new Set)},U=async()=>{if(0!==D.size&&confirm("Are you sure you want to delete ".concat(D.size," cookies? This cannot be undone."))){A(!0);try{let e=await fetch("/api/cookies/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filenames:Array.from(D)})}),t=await e.text();if(!e.ok)throw Error("Delete failed: ".concat(e.status," - ").concat(t));await O(),T(new Set)}catch(e){console.error("Delete error",e),m("Failed to delete cookies: ".concat(e.message))}finally{A(!1)}}};return t||!e?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900 flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-white text-xl",children:"Loading..."})}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900 p-8",children:(0,s.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl border border-white/20",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-4xl font-bold text-white mb-2 flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-5xl",children:"\uD83C\uDF6A"}),"Cookie Manager"]}),(0,s.jsxs)("div",{className:"text-sm text-white/60",children:["Logged in as ",(0,s.jsx)("span",{className:"font-semibold text-white",children:e.username})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:L,disabled:E,className:"px-4 py-2 text-white rounded-lg transition-colors flex items-center gap-2 font-medium ".concat(E?"bg-orange-600/50 cursor-not-allowed":"bg-orange-600 hover:bg-orange-700 shadow-lg shadow-orange-900/50"),children:E?"Restarting...":"↻ Restart Service"}),"list"===p&&D.size>0&&(0,s.jsx)("button",{onClick:U,disabled:P,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors flex items-center gap-2 font-medium",children:P?"Deleting...":"Delete (".concat(D.size,")")}),"list"!==p&&(0,s.jsx)("button",{onClick:()=>g("list"),className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"← Back to List"}),"list"===p&&(0,s.jsx)("button",{onClick:()=>{j(""),N(""),k(null),g("create")},className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors font-medium shadow-lg shadow-purple-900/50",children:"+ New Cookie"})]})]}),x&&(0,s.jsxs)("div",{className:"mb-6 space-y-2",children:[(0,s.jsxs)("div",{className:"p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-red-200 flex justify-between items-center",children:[(0,s.jsx)("span",{children:x}),(0,s.jsx)("button",{onClick:()=>m(""),className:"ml-4 underline text-xs hover:text-white",children:"Close"})]}),(0,s.jsxs)("div",{className:"p-2 bg-black/50 border border-white/10 rounded font-mono text-xs text-white/60",children:[(0,s.jsx)("strong",{children:"Debug Log:"}),(0,s.jsx)("pre",{className:"whitespace-pre-wrap mt-1",children:x})]})]}),"list"===p&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-black/20 border border-white/5 rounded-lg p-2 flex gap-4 text-xs px-4 items-center",children:[(0,s.jsx)("button",{onClick:()=>M(!0),className:"hover:text-white text-white/60 transition-colors",children:"Select All"}),(0,s.jsx)("div",{className:"w-px h-3 bg-white/10"}),(0,s.jsx)("button",{onClick:()=>M(!1),className:"hover:text-white text-white/60 transition-colors",children:"Deselect All"}),(0,s.jsx)("div",{className:"w-px h-3 bg-white/10"}),(0,s.jsx)("button",{onClick:()=>{T(new Set(o.filter(e=>0===_(e).length).map(e=>e.filename)))},className:"hover:text-blue-300 text-blue-400/80 transition-colors",children:"Select Unused"}),(0,s.jsxs)("span",{className:"ml-auto text-white/40",children:[D.size," selected"]})]}),0===o.length&&!h&&(0,s.jsxs)("div",{className:"text-white/60 text-center py-12 border-2 border-dashed border-white/10 rounded-xl",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCED"}),"No cookies found. Create one to get started."]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(e=>{let t=_(e),r=0===t.length;return(0,s.jsxs)("div",{onClick:()=>B(e.filename),className:"group relative p-5 rounded-xl border transition-all cursor-pointer flex flex-col h-full ".concat(D.has(e.filename)?"bg-purple-900/40 border-purple-500/50 shadow-lg shadow-purple-900/20":"bg-black/20 border-white/10 hover:bg-black/40 hover:border-purple-500/30"),children:[(0,s.jsx)("div",{className:"absolute top-4 right-4 z-10",children:(0,s.jsx)("input",{type:"checkbox",checked:D.has(e.filename),onChange:()=>B(e.filename),className:"w-5 h-5 rounded border-white/30 bg-black/50 checked:bg-purple-600 accent-purple-600 cursor-pointer",onClick:e=>e.stopPropagation()})}),(0,s.jsx)("div",{className:"flex justify-between items-start mb-3 pr-8",children:(0,s.jsx)("h3",{className:"text-lg font-bold text-white group-hover:text-purple-300 transition-colors truncate w-full",title:e.name,children:e.name})}),(0,s.jsx)("div",{className:"mb-3",children:r?(0,s.jsx)("span",{className:"px-2 py-0.5 bg-yellow-500/20 text-yellow-200 text-xs rounded border border-yellow-500/30",children:"Unused"}):(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:t.map(e=>(0,s.jsx)("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-200 text-xs rounded border border-green-500/30",children:e.name},e.name))})}),(0,s.jsx)("div",{className:"flex-grow",children:(0,s.jsx)("code",{className:"text-xs text-white/40 break-all block",children:e.filename})}),(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-white/5 flex justify-between items-center text-xs text-white/50",children:[(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("span",{children:[(e.size/1024).toFixed(2)," KB"]}),(0,s.jsx)("span",{children:new Date(e.lastModified).toLocaleDateString()})]}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),z(e.name)},className:"p-1.5 hover:bg-white/10 rounded-full text-white/40 hover:text-white transition-colors",title:"Edit Content",children:(0,s.jsx)("span",{className:"text-lg",children:"✏️"})})]})]},e.name)})})]}),("edit"===p||"create"===p)&&(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"create"===p?"Create New Cookie":"Editing ".concat(w)}),(0,s.jsxs)("form",{onSubmit:R,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Finder Name (Crawler Identifier)"}),(0,s.jsx)("input",{type:"text",required:!0,disabled:"edit"===p,className:"w-full px-4 py-2 bg-black/30 border border-white/10 rounded-lg text-white placeholder-white/30 focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:opacity-50",placeholder:"e.g. twitter",value:w,onChange:e=>j(e.target.value)}),(0,s.jsx)("p",{className:"mt-1 text-xs text-white/40",children:"This will determine the filename (e.g., twitter.txt)"})]}),w&&(0,s.jsxs)("div",{className:"p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("h3",{className:"text-sm font-bold text-blue-300",children:"Used By"})]}),(()=>{let e=o.find(e=>e.name===w||e.filename.includes(w)),t=e?_(e):[];return 0===t.length?(0,s.jsx)("p",{className:"text-sm text-white/60",children:"This cookie is not currently used by any crawler."}):(0,s.jsx)("div",{className:"space-y-1",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-white/80 bg-white/5 px-2 py-1 rounded",children:[(0,s.jsx)("span",{className:"text-green-400",children:"✓"}),(0,s.jsx)("span",{className:"font-mono",children:e.name||"Unnamed Crawler"})]},t))})})()]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Cookie Content (Netscape Format)"}),(0,s.jsx)("textarea",{rows:12,required:!0,className:"w-full px-4 py-2 bg-black/30 border border-white/10 rounded-lg text-white font-mono text-xs placeholder-white/30 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"# Netscape HTTP Cookie File...",value:v,onChange:e=>N(e.target.value)})]}),(0,s.jsx)("div",{className:"flex gap-4",children:(0,s.jsx)("button",{type:"submit",disabled:C,className:"flex-1 py-3 px-4 rounded-lg text-white font-medium shadow-lg transition-all ".concat(C?"bg-purple-600/50 cursor-not-allowed":"bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 transform hover:-translate-y-0.5"),children:C?"Saving...":"Save Cookie"})}),y&&(0,s.jsx)("div",{className:"p-4 rounded-lg text-center text-sm ".concat(y.startsWith("Success")?"bg-green-500/20 text-green-200 border border-green-500/30":"bg-red-500/20 text-red-200 border border-red-500/30"),children:y})]})]})]})})})}},4759:(e,t,r)=>{Promise.resolve().then(r.bind(r,571))},8712:(e,t,r)=>{"use strict";r.d(t,{WithAuth:()=>n,A:()=>o});var s=r(5155),a=r(2115);let l=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,a.useState)(null),[o,n]=(0,a.useState)(!0),c=async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let t=await e.json();i(t)}else i(null)}catch(e){console.error("Failed to fetch user:",e),i(null)}finally{n(!1)}},d=async(e,t)=>{try{let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:e,password:t})});if(r.ok){let e=await r.json();return i(e),!0}return!1}catch(e){return console.error("Login failed:",e),!1}},h=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Logout failed:",e)}i(null)},u=async()=>{await c()};return(0,a.useEffect)(()=>{c()},[]),(0,s.jsx)(l.Provider,{value:{user:r,loading:o,login:d,logout:h,refreshUser:u},children:t})}function o(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function n(e){let{children:t}=e;return(0,s.jsx)(i,{children:t})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=4759)),_N_E=e.O()}]);