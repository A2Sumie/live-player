(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[852],{63:(e,t,s)=>{"use strict";var r=s(7260);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},2853:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var r=s(5155),l=s(2115),a=s(63),n=s(8712);function i(){let[e,t]=(0,l.useState)([]),[s,i]=(0,l.useState)(!0),[c,d]=(0,l.useState)(!1),{user:o,loading:u}=(0,n.A)(),h=(0,a.useRouter)();async function m(){try{let e=await fetch("/api/schedules?upcoming=true");if(e.ok){let s=await e.json();t(s)}}catch(e){console.error("Failed to load schedules:",e)}finally{i(!1)}}async function x(e){e.preventDefault();let t=new FormData(e.currentTarget),s={title:t.get("title"),description:t.get("description"),scheduleType:t.get("scheduleType"),executionTime:new Date(t.get("executionTime")).toISOString()};("workflow"===s.scheduleType||"stream"===s.scheduleType)&&(s.payload={type:"start_network_stream",playerId:t.get("playerId"),source:t.get("source"),name:t.get("title")});try{(await fetch("/api/schedules",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok?(d(!1),m(),e.target.reset()):alert("创建失败")}catch(e){console.error("Failed to create schedule:",e),alert("创建失败")}}async function p(e){if(confirm("确认删除此日程？"))try{(await fetch("/api/schedules/".concat(e),{method:"DELETE"})).ok&&m()}catch(e){console.error("Failed to delete schedule:",e)}}return((0,l.useEffect)(()=>{u||o||h.push("/auth/login?redirect=/cic")},[o,u,h]),(0,l.useEffect)(()=>{if(o){m();let e=setInterval(m,3e4);return()=>clearInterval(e)}},[o]),u||!o)?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-white",children:"Loading..."})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 to-blue-600 p-8",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsxs)("header",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"\uD83C\uDFAC StreamServ Control Center"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:"集中控制面板 - cic.n2nj.moe"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Logged in as: ",o.username," (",o.role,")"]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:(0,r.jsxs)("div",{className:"flex gap-3 flex-wrap",children:[(0,r.jsx)("button",{onClick:()=>d(!c),className:"bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition",children:c?"取消":"+ 创建新日程"}),(0,r.jsxs)("a",{href:"/cookies/view",className:"bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition inline-flex items-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83C\uDF6A"}),(0,r.jsx)("span",{children:"Cookie Manager"})]}),(0,r.jsxs)("a",{href:"/config",className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition inline-flex items-center gap-2",children:[(0,r.jsx)("span",{children:"⚙️"}),(0,r.jsx)("span",{children:"Crawler Config"})]})]})}),c&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"创建新日程"}),(0,r.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"标题 *"}),(0,r.jsx)("input",{type:"text",name:"title",required:!0,className:"w-full border rounded px-3 py-2",placeholder:"例如：转播推特空间"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"描述"}),(0,r.jsx)("textarea",{name:"description",className:"w-full border rounded px-3 py-2",rows:3,placeholder:"详细描述..."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"类型 *"}),(0,r.jsxs)("select",{name:"scheduleType",required:!0,className:"w-full border rounded px-3 py-2",children:[(0,r.jsx)("option",{value:"stream",children:"直播流"}),(0,r.jsx)("option",{value:"workflow",children:"工作流"}),(0,r.jsx)("option",{value:"reminder",children:"提醒"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"执行时间 *"}),(0,r.jsx)("input",{type:"datetime-local",name:"executionTime",required:!0,className:"w-full border rounded px-3 py-2"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"播放器ID"}),(0,r.jsx)("input",{type:"text",name:"playerId",className:"w-full border rounded px-3 py-2",placeholder:"web-1, web-2..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"流地址"}),(0,r.jsx)("input",{type:"url",name:"source",className:"w-full border rounded px-3 py-2",placeholder:"https://..."})]})]}),(0,r.jsx)("button",{type:"submit",className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition",children:"创建日程"})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"\uD83D\uDCC5 即将到来的日程"}),s?(0,r.jsx)("p",{className:"text-gray-500 text-center py-8",children:"加载中..."}):0===e.length?(0,r.jsx)("p",{className:"text-gray-500 text-center py-8",children:"暂无日程"}):(0,r.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,r.jsx)("div",{className:"border rounded-lg p-4 hover:shadow-md transition",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:e.title}),e.description&&(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:e.description}),(0,r.jsxs)("div",{className:"flex gap-4 mt-2 text-sm text-gray-500",children:[(0,r.jsxs)("span",{children:["⏰ ",new Date(e.executionTime).toLocaleString("zh-CN")]}),(0,r.jsxs)("span",{children:["\uD83D\uDCCB ",e.scheduleType]}),(0,r.jsxs)("span",{children:["✅ ",e.status]})]})]}),(0,r.jsx)("button",{onClick:()=>p(e.id),className:"text-red-600 hover:text-red-800 ml-4",children:"删除"})]})},e.id))})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mt-8",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-2",children:"\uD83D\uDCD6 公开API"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["公开只读日程: ",(0,r.jsx)("code",{className:"bg-gray-100 px-2 py-1 rounded",children:"GET /api/schedules/public"})]}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:"这个API可以在公开网页上使用，无需认证。"})]})]})})}},8681:(e,t,s)=>{Promise.resolve().then(s.bind(s,2853))},8712:(e,t,s)=>{"use strict";s.d(t,{WithAuth:()=>c,A:()=>i});var r=s(5155),l=s(2115);let a=(0,l.createContext)(void 0);function n(e){let{children:t}=e,[s,n]=(0,l.useState)(null),[i,c]=(0,l.useState)(!0),d=async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let t=await e.json();n(t)}else n(null)}catch(e){console.error("Failed to fetch user:",e),n(null)}finally{c(!1)}},o=async(e,t)=>{try{let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:e,password:t})});if(s.ok){let e=await s.json();return n(e),!0}return!1}catch(e){return console.error("Login failed:",e),!1}},u=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Logout failed:",e)}n(null)},h=async()=>{await d()};return(0,l.useEffect)(()=>{d()},[]),(0,r.jsx)(a.Provider,{value:{user:s,loading:i,login:o,logout:u,refreshUser:h},children:t})}function i(){let e=(0,l.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function c(e){let{children:t}=e;return(0,r.jsx)(n,{children:t})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=8681)),_N_E=e.O()}]);