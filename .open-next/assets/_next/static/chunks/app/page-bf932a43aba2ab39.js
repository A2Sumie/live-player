(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1469:(e,r,t)=>{Promise.resolve().then(t.bind(t,2687))},2687:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>y});var l=t(5155),a=t(2115),o=t(8712);function s(){let{user:e,logout:r}=(0,o.A)();return(null==e?void 0:e.role)!=="admin"?null:(0,l.jsxs)("div",{className:"flex items-center gap-4 mb-8",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,l.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Admin"}),(0,l.jsxs)("span",{children:["Current User: ",e.username]})]}),(0,l.jsx)("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-red-600 bg-red-50 border border-red-200 rounded-md hover:bg-red-100 transition-colors",children:"Logout"})]})}function n(e){let{onClick:r,variant:t="normal"}=e,{user:a}=(0,o.A)();return(null==a?void 0:a.role)!=="admin"?null:"card"===t?(0,l.jsx)("div",{onClick:r,className:"bg-white border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all duration-300 cursor-pointer group",style:{aspectRatio:"16/9"},children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 group-hover:text-blue-500 transition-colors",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-100 group-hover:bg-blue-100 flex items-center justify-center mb-3 transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(0,l.jsx)("span",{className:"text-sm font-medium",children:"Add Player"})]})}):(0,l.jsxs)("button",{onClick:r,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:[(0,l.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Player"]})}var i=t(2619),c=t.n(i);function d(e){let{player:r,onEdit:t,onDelete:a}=e,{user:s}=(0,o.A)(),n=(()=>{if(r.coverImage){let e=btoa(String.fromCharCode(...(Array.isArray(r.coverImage),new Uint8Array(r.coverImage))));return"data:image/jpeg;base64,".concat(e)}return r.coverUrl||null})(),i=e=>{e.preventDefault(),e.stopPropagation(),null==t||t(r)},d=async e=>{e.preventDefault(),e.stopPropagation(),confirm("Are you sure you want to delete this player?")&&(null==a||a(r))};return(0,l.jsx)("div",{className:"group relative",children:(0,l.jsx)(c(),{href:"/player/".concat(r.pId),className:"block",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300",children:[n&&(0,l.jsxs)("div",{className:"aspect-w-16 aspect-h-9 relative",children:[(0,l.jsx)("img",{src:n,alt:r.name,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"}),(null==s?void 0:s.role)==="admin"&&(0,l.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,l.jsx)("button",{onClick:i,className:"p-1.5 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors shadow-lg",title:"Edit",children:(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,l.jsx)("button",{onClick:d,className:"p-1.5 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors shadow-lg",title:"Delete",children:(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600",children:r.name}),r.description&&(0,l.jsx)("p",{className:"text-gray-600 text-sm line-clamp-2 mb-3",children:r.description}),r.announcement&&(0,l.jsx)("div",{className:"p-2 bg-yellow-50 border-l-4 border-yellow-400 rounded",children:(0,l.jsx)("p",{className:"text-yellow-800 text-xs",children:r.announcement})}),(null==s?void 0:s.role)==="admin"&&!n&&(0,l.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,l.jsx)("button",{onClick:i,className:"flex-1 px-3 py-1 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 transition-colors",children:"Edit"}),(0,l.jsx)("button",{onClick:d,className:"flex-1 px-3 py-1 text-xs font-medium text-red-600 bg-red-50 border border-red-200 rounded hover:bg-red-100 transition-colors",children:"Delete"})]})]})]})})})}function u(e){return e.toLowerCase().includes(".m3u8")||e.toLowerCase().includes("m3u")}async function m(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{width:l=400,height:a=225,quality:o=.8,currentTime:s=2}=r;return new Promise(async(r,n)=>{let i=document.createElement("video"),c=document.createElement("canvas"),d=c.getContext("2d");if(!d)return void n(Error("Failed to get canvas context"));let m=null;i.crossOrigin="anonymous",i.muted=!0,i.preload="metadata";let h=()=>{m&&m.destroy(),i.remove(),c.remove()},f=setTimeout(()=>{h(),n(Error("Video loading timeout"))},3e4);i.addEventListener("error",e=>{h(),clearTimeout(f),n(Error("Video loading failed: ".concat(e.type)))});try{if(u(e)){let{default:r}=await t.e(910).then(t.bind(t,7088));if(r.isSupported()){let t=new URL(e).searchParams;(m=new r({enableWorker:!1,xhrSetup(e,r){if(r.includes(".ts")||r.endsWith(".m3u8")){let l=new URL(r);t.forEach((e,r)=>{l.searchParams.set(r,e)}),e.open("GET",l.toString(),!0)}}})).loadSource(e),m.attachMedia(i),m.on(r.Events.ERROR,(e,r)=>{console.error("HLS error:",r),r.fatal&&(h(),clearTimeout(f),n(Error("HLS fatal error: ".concat(r.type))))})}else if(i.canPlayType("application/vnd.apple.mpegurl"))i.src=e,i.load();else{h(),clearTimeout(f),n(Error("HLS is not supported in this browser"));return}}else i.src=e,i.load();i.addEventListener("loadedmetadata",()=>{i.currentTime=s}),i.addEventListener("seeked",()=>{clearTimeout(f);try{c.width=l,c.height=a,d.drawImage(i,0,0,l,a),c.toBlob(e=>{h(),e?r(e):n(Error("Failed to create blob from canvas"))},"image/jpeg",o)}catch(e){h(),n(e)}},{once:!0})}catch(e){h(),clearTimeout(f),n(Error("Failed to load video: ".concat(e)))}})}async function h(e){try{let r=new URL(e).searchParams,t=await fetch(e);if(!t.ok)throw Error("Failed to fetch HLS manifest");for(let l of(await t.text()).split("\n")){let t=l.trim();if(t&&!t.startsWith("#")){let l;if(t.startsWith("http"))l=t;else{let r=new URL(e);l=new URL(t,r.href).href}if(r.size>0){let e=new URL(l);r.forEach((r,t)=>{e.searchParams.set(t,r)}),l=e.toString()}return l}}throw Error("No TS segments found in HLS manifest")}catch(e){throw Error("Failed to get first segment: ".concat(e))}}async function f(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=u(e),a=e;if(l)try{a=await h(e),console.log("Using first TS segment:",a)}catch(l){return console.error("Failed to get TS segment, using quick capture logic:",l),await p(e,r,t)}return await x(a,r,t)}async function p(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=Array.from({length:r},(e,t)=>2+6/(r-1)*t).map(async(r,l)=>{try{let a=await m(e,{...t,width:t.width||320,height:t.height||180,quality:t.quality||.7,currentTime:r});return{blob:a,previewUrl:URL.createObjectURL(a),timepoint:r,index:l}}catch(e){return console.error("Failed to capture frame ".concat(l+1,":"),e),null}});return(await Promise.all(l)).filter(e=>null!==e).sort((e,r)=>e.index-r.index).map(e=>{let{blob:r,previewUrl:t,timepoint:l}=e;return{blob:r,previewUrl:t,timepoint:l}})}async function x(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{width:l=320,height:a=180,quality:o=.7}=t,s=Array.from({length:r},(e,t)=>.5+5/(r-1)*t).map(async(r,t)=>{try{let s=await m(e,{width:l,height:a,quality:o,currentTime:r});return{blob:s,previewUrl:URL.createObjectURL(s),timepoint:r,index:t}}catch(e){return console.error("Failed to capture frame ".concat(t+1," from segment:"),e),null}});return(await Promise.all(s)).filter(e=>null!==e).sort((e,r)=>e.index-r.index).map(e=>{let{blob:r,previewUrl:t,timepoint:l}=e;return{blob:r,previewUrl:t,timepoint:l}})}async function g(e){let r=u(e);return m(e,{width:400,height:225,quality:.8,currentTime:r?5:2})}function b(e){let{frames:r,onSelect:t,onCancel:o,loading:s}=e,[n,i]=(0,a.useState)(null);(0,a.useEffect)(()=>()=>{r.forEach(e=>{e.previewUrl&&URL.revokeObjectURL(e.previewUrl)})},[r]);let c=e=>{let r=Math.floor(e/60),t=Math.floor(e%60);return"".concat(r,":").concat(t.toString().padStart(2,"0"))};return s?(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-4xl mx-auto",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Capturing frames from first segment..."}),(0,l.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,l.jsx)("span",{className:"ml-3 text-gray-600",children:"Analyzing segment content, please wait..."})]})]}):0===r.length?(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-4xl mx-auto",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Capture Failed"}),(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:"Unable to capture cover frames from video, please check if the video URL is correct."}),(0,l.jsx)("button",{onClick:o,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200",children:"Close"})]}):(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-4xl mx-auto",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Select Cover Image"}),(0,l.jsxs)("span",{className:"text-sm text-gray-500",children:["Captured ",r.length," frames from first segment, please select one as cover"]})]}),(0,l.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 mb-6",children:r.map((e,r)=>(0,l.jsxs)("div",{className:"relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ".concat(n===e?"border-blue-500 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300"),onClick:()=>i(e),children:[(0,l.jsx)("img",{src:e.previewUrl,alt:"Frame ".concat(r+1),className:"w-full h-auto aspect-video object-cover"}),(0,l.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2",children:(0,l.jsxs)("div",{className:"text-white text-xs",children:[(0,l.jsxs)("div",{children:["Frame ",r+1]}),(0,l.jsx)("div",{children:c(e.timepoint)})]})}),n===e&&(0,l.jsx)("div",{className:"absolute top-2 right-2",children:(0,l.jsx)("div",{className:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm",children:"✓"})})]},r))}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("div",{className:"text-sm text-gray-600",children:n?(0,l.jsxs)("span",{children:["Selected: Frame ",r.indexOf(n)+1,"(",c(n.timepoint),")"]}):(0,l.jsx)("span",{children:"Please select a cover frame"})}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("button",{onClick:o,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors",children:"Cancel"}),(0,l.jsx)("button",{onClick:()=>{n&&t(n)},disabled:!n,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Confirm Selection"})]})]})]})}function v(e){let{isOpen:r,onClose:t,onSubmit:o,player:s,loading:n}=e,[i,c]=(0,a.useState)({name:"",pId:"",description:"",url:"",coverUrl:"",announcement:""}),[d,u]=(0,a.useState)(null),[m,h]=(0,a.useState)(!1),[p,x]=(0,a.useState)(!1),[v,y]=(0,a.useState)(null),[j,w]=(0,a.useState)(!1),[N,k]=(0,a.useState)(!1),[C,L]=(0,a.useState)([]),[U,E]=(0,a.useState)(!1);(0,a.useEffect)(()=>{r?s?c({name:s.name,pId:s.pId,description:s.description||"",url:s.url,coverUrl:s.coverUrl||"",announcement:s.announcement||""}):c({name:"",pId:"",description:"",url:"",coverUrl:"",announcement:""}):v&&(URL.revokeObjectURL(v),y(null))},[r,s]),(0,a.useEffect)(()=>()=>{v&&URL.revokeObjectURL(v)},[v]);let S=e=>{let{name:r,value:t}=e.target;c(e=>({...e,[r]:t}))},R=async()=>{if(d&&(null==s?void 0:s.id)){h(!0);try{let e=new FormData;e.append("cover",d);let r=await fetch("/api/players/".concat(s.id,"/cover"),{method:"POST",body:e});if(r.ok){alert("Cover image uploaded successfully!"),u(null);let e=document.getElementById("coverFile");e&&(e.value="")}else{let e=await r.json();alert(e.error||"Failed to upload cover image")}}catch(e){console.error("Error uploading cover:",e),alert("Failed to upload cover image")}h(!1)}},P=async()=>{let e;if(null==s?void 0:s.id){if(v)try{let r=await fetch(v);e=await r.blob()}catch(e){alert("Unable to use preview image");return}else{let r=i.url||s.url;if(!r)return void alert("Please enter video URL first");try{e=await g(r)}catch(e){console.error("Error capturing cover:",e),alert("Cover capture failed, please check if the video URL is correct");return}}x(!0);try{let r=new FormData;r.append("cover",e,"cover.jpg");let t=await fetch("/api/players/".concat(s.id,"/cover"),{method:"POST",body:r});if(t.ok)alert("Cover uploaded successfully!"),y(null);else{let e=await t.json();alert(e.error||"Cover upload failed")}}catch(e){console.error("Error uploading cover:",e),alert("Cover upload failed")}x(!1)}},T=async()=>{let e=i.url||(null==s?void 0:s.url);if(!e)return void alert("Please enter video URL first");let r=e.toLowerCase().includes(".m3u8")||e.toLowerCase().includes("m3u");w(!0);try{let r=await g(e),t=URL.createObjectURL(r);y(t)}catch(t){console.error("Error previewing cover:",t);let e="Preview failed, please check if the video URL is correct";r&&(e="HLS stream preview failed, please check:\n1. Is the URL correct\n2. Is the video stream accessible\n3. Are there CORS restrictions"),alert(e)}w(!1)},F=async()=>{let e=i.url||(null==s?void 0:s.url);if(!e)return void alert("Please enter video URL first");E(!0),k(!0);try{let r=await f(e,8);L(r)}catch(e){console.error("Error capturing multiple frames:",e),alert("Batch capture failed, please check if the video URL is correct"),k(!1)}E(!1)},O=async e=>{if(null==s?void 0:s.id){x(!0);try{let r=new FormData;r.append("cover",e.blob,"cover.jpg");let t=await fetch("/api/players/".concat(s.id,"/cover"),{method:"POST",body:r});if(t.ok)alert("Cover uploaded successfully!"),k(!1),C.forEach(e=>{e.previewUrl&&URL.revokeObjectURL(e.previewUrl)}),L([]);else{let e=await t.json();alert(e.error||"Cover upload failed")}}catch(e){console.error("Error uploading selected frame:",e),alert("Cover upload failed")}x(!1)}};return r?N?(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,l.jsx)(b,{frames:C,onSelect:O,onCancel:()=>{k(!1),C.forEach(e=>{e.previewUrl&&URL.revokeObjectURL(e.previewUrl)}),L([])},loading:U})}):(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,l.jsx)("div",{className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:s?"Edit Player":"Create Player"}),(0,l.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),o(i)},className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Player Name *"}),(0,l.jsx)("input",{type:"text",id:"name",name:"name",required:!0,value:i.name,onChange:S,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter player name"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"pId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Player ID *"}),(0,l.jsx)("input",{type:"text",id:"pId",name:"pId",required:!0,value:i.pId,onChange:S,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter unique player ID"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"url",className:"block text-sm font-medium text-gray-700 mb-1",children:"Player URL *"}),(0,l.jsx)("input",{type:"url",id:"url",name:"url",required:!0,value:i.url,onChange:S,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"https://example.com/stream.m3u8"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"coverUrl",className:"block text-sm font-medium text-gray-700 mb-1",children:"Cover Image URL"}),(0,l.jsx)("input",{type:"url",id:"coverUrl",name:"coverUrl",value:i.coverUrl,onChange:S,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"https://example.com/cover.jpg"})]}),s&&(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cover Image Upload"}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("input",{type:"file",id:"coverFile",accept:"image/*",onChange:e=>{var r;u((null==(r=e.target.files)?void 0:r[0])||null)},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),(0,l.jsx)("button",{type:"button",onClick:R,disabled:!d||m,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:m?"Uploading...":"Upload"})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"Or capture from video:"}),(0,l.jsx)("button",{type:"button",onClick:T,disabled:j||!i.url,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:j?"Capturing...":"Quick Capture"}),(0,l.jsx)("button",{type:"button",onClick:F,disabled:U||!i.url,className:"px-3 py-1 text-sm font-medium text-white bg-purple-600 border border-transparent rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:U?"Capturing...":"Multi-frame Selection"})]}),i.url&&(i.url.toLowerCase().includes(".m3u8")||i.url.toLowerCase().includes("m3u"))&&(0,l.jsxs)("div",{className:"text-xs text-blue-600 bg-blue-50 p-2 rounded space-y-1",children:[(0,l.jsx)("div",{children:"\uD83D\uDCA1 HLS stream (.m3u8) detected, capture may take longer, please be patient"}),new URL(i.url).search&&(0,l.jsx)("div",{children:"\uD83D\uDD11 URL parameters detected, will be automatically passed to all video segments"})]}),v&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("div",{className:"text-sm text-gray-700",children:"Capture Preview:"}),(0,l.jsx)("img",{src:v,alt:"Cover preview",className:"w-full max-w-xs h-auto border rounded-md"}),(0,l.jsx)("button",{type:"button",onClick:P,disabled:p,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:p?"Uploading...":"Use This Cover"})]})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,l.jsx)("textarea",{id:"description",name:"description",rows:3,value:i.description,onChange:S,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter player description"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"announcement",className:"block text-sm font-medium text-gray-700 mb-1",children:"Announcement"}),(0,l.jsx)("textarea",{id:"announcement",name:"announcement",rows:2,value:i.announcement,onChange:S,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter announcement"})]}),(0,l.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,l.jsx)("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",disabled:n,className:"flex-1 px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:n?"Saving...":s?"Update":"Create"})]})]})]})})}):null}function y(){let[e,r]=(0,a.useState)([]),[t,i]=(0,a.useState)(!0),[c,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(null),[f,p]=(0,a.useState)(!1),{user:x}=(0,o.A)(),g=async()=>{try{let e=await fetch("/api/players");if(e.ok){let t=await e.json();r(t)}}catch(e){console.error("Error fetching players:",e)}finally{i(!1)}};(0,a.useEffect)(()=>{g()},[]);let b=()=>{h(null),u(!0)},y=e=>{h(e),u(!0)},j=async e=>{try{let t=await fetch("/api/players/".concat(e.id),{method:"DELETE",credentials:"include"});if(t.ok)r(r=>r.filter(r=>r.id!==e.id));else{let e=await t.json();alert(e.error||"Delete failed")}}catch(e){console.error("Error deleting player:",e),alert("Delete failed")}},w=async e=>{p(!0);try{let t=!!m,l=t?"/api/players/".concat(m.id):"/api/players",a=await fetch(l,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(a.ok){let e=await a.json();t?r(r=>r.map(r=>r.id===m.id?e:r)):r(r=>[e,...r]),u(!1),h(null)}else{let e=await a.json();alert(e.error||(t?"Update failed":"Create failed"))}}catch(e){console.error("Error submitting player:",e),alert(m?"Update failed":"Create failed")}finally{p(!1)}};return t?(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:'url("/background.png")'},children:[(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,l.jsxs)("div",{className:"text-center mb-8",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"TV.N2NJ.MOE 共星组呈上"}),(0,l.jsx)("h2",{className:"text-xl text-gray-700 font-medium",children:"为22/7以及秋系同好的转播站 基于ChocoLZS/live-player 群组@Q.161717573"})]}),(0,l.jsx)(s,{}),(null==x?void 0:x.role)==="admin"&&(0,l.jsx)("div",{className:"flex justify-center mb-8",children:(0,l.jsx)(n,{onClick:b})})]}),0===e.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("p",{className:"text-gray-500 text-lg mb-4",children:"No players found"}),(null==x?void 0:x.role)==="admin"&&(0,l.jsx)(n,{onClick:b})]}):(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[e.map(e=>(0,l.jsx)(d,{player:e,onEdit:y,onDelete:j},e.id)),(null==x?void 0:x.role)==="admin"&&(0,l.jsx)(n,{onClick:b,variant:"card"})]})]}),(0,l.jsx)(v,{isOpen:c,onClose:()=>{u(!1),h(null)},onSubmit:w,player:m,loading:f})]})}},8712:(e,r,t)=>{"use strict";t.d(r,{WithAuth:()=>i,A:()=>n});var l=t(5155),a=t(2115);let o=(0,a.createContext)(void 0);function s(e){let{children:r}=e,[t,s]=(0,a.useState)(null),[n,i]=(0,a.useState)(!0),c=async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let r=await e.json();s(r)}else s(null)}catch(e){console.error("Failed to fetch user:",e),s(null)}finally{i(!1)}},d=async(e,r)=>{try{let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:e,password:r})});if(t.ok){let e=await t.json();return s(e),!0}return!1}catch(e){return console.error("Login failed:",e),!1}},u=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Logout failed:",e)}s(null)},m=async()=>{await c()};return(0,a.useEffect)(()=>{c()},[]),(0,l.jsx)(o.Provider,{value:{user:t,loading:n,login:d,logout:u,refreshUser:m},children:r})}function n(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function i(e){let{children:r}=e;return(0,l.jsx)(s,{children:r})}}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=1469)),_N_E=e.O()}]);